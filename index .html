<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>常德→拉萨机车旅行 - 完整行程</title>
<link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <style>
        /* 回到顶部按钮 */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow-hover);
            transition: var(--transition);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
        }

        .back-to-top.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .back-to-top:hover {
            background-color: var(--primary-dark);
            transform: translateY(-5px);
        }

        .back-to-top:active {
            transform: scale(0.95);
        }

        /* 移动端优化 */
        @media (max-width: 768px) {
            .back-to-top {
                bottom: 20px;
                right: 20px;
                width: 44px;
                height: 44px;
            }
        }
        :root {
            --primary: #165DFF;
            --primary-light: #E8F3FF;
            --primary-dark: #0E42CC;
            --depart: #00B42A;
            --depart-light: #E8FFF0;
            --depart-dark: #008A1E;
            --stay: #FF7D00;
            --stay-light: #FFF8E8;
            --stay-dark: #E66A00;
            --return: #168CFF;
            --return-light: #E8F5FF;
            --return-dark: #0E72D2;
            --dark: #1D2129;
            --gray: #4E5969;
            --light-gray: #C9CDD4;
            --border: #F0F2F5;
            --bg: #FAFAFA;
            --white: #FFFFFF;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 8px 30px rgba(0, 0, 0, 0.12);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --expand-transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'PingFang SC', 'Microsoft Yahei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg);
            color: var(--dark);
            line-height: 1.6;
            font-size: 14px;
            padding-top: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* 导航栏 - 移动端优化 */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background-color: var(--white);
            display: flex;
            align-items: center;
            padding: 0 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            z-index: 1000;
            justify-content: space-between;
        }

        .navbar-content {
            max-width: 1200px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            font-weight: 700;
            font-size: 18px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo i {
            font-size: 22px;
        }

        .search-container {
            position: relative;
            flex: 1;
            max-width: 400px;
            margin: 0 15px;
        }

        .search-input {
            width: 100%;
            height: 38px;
            border-radius: 19px;
            border: 1px solid var(--border);
            padding: 0 15px 0 38px;
            font-size: 13px;
            outline: none;
            transition: var(--transition);
        }

        .search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(22, 93, 255, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 16px;
        }

        /* 移动端搜索按钮 */
        .mobile-search-btn {
            display: none;
            background: none;
            border: none;
            color: var(--gray);
            font-size: 18px;
            cursor: pointer;
            margin-right: 10px;
        }

        /* 移动端搜索模态框 */
        .mobile-search-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--white);
            z-index: 2000;
            padding: 70px 15px 15px;
        }

        .mobile-search-modal.active {
            display: block;
        }

        .mobile-search-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .mobile-search-input {
            flex: 1;
            height: 44px;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0 15px;
            font-size: 16px;
            outline: none;
        }

        .mobile-search-close {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 20px;
            margin-left: 10px;
            cursor: pointer;
        }

        /* 顶部Header */
        .header {
            background: linear-gradient(135deg, #0F172A, #1E293B);
            padding: 30px 15px 20px;
            color: white;
            position: relative;
            overflow: hidden;
            width: 100%;
        }

        .header-content {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .trip-tag {
            display: inline-block;
            background: rgba(22, 140, 255, 0.2);
            color: var(--primary);
            font-size: 12px;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
            margin-bottom: 12px;
            border: 1px solid rgba(22, 140, 255, 0.3);
        }

        h1 {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: 0.3px;
        }

        .subtitle {
            font-size: 14px;
            color: #A5B4FC;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        /* 行程概览 - 移动端优化 */
        .overview {
            padding: 15px 10px;
            background: white;
            border-bottom: 1px solid var(--border);
            position: relative;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* 行程概览卡片 - 移动端优化 */
        .overview-card {
            background: var(--primary-light);
            padding: 15px 10px;
            border-radius: 10px;
            text-align: center;
            min-width: 80px;
            flex: 1;
            max-width: 120px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            will-change: transform;
            transform: translateZ(0);
        }

        .overview-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.1);
            transform: scaleX(0);
            transition: var(--transition);
        }

        .overview-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-hover);
        }

        .overview-card:hover::before {
            transform: scaleX(1);
        }

        .overview-card:active {
            transform: scale(0.98);
        }

        .overview-card.active {
            background: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(22, 93, 255, 0.2);
        }

        .overview-card.active .overview-icon,
        .overview-card.active .overview-label,
        .overview-card.active .overview-value {
            color: white;
        }

        .overview-icon {
            font-size: 20px;
            color: var(--primary);
            margin-bottom: 6px;
            transition: var(--transition);
        }

        .overview-label {
            font-size: 11px;
            color: var(--gray);
            margin-bottom: 3px;
            transition: var(--transition);
        }

        .overview-value {
            font-size: 15px;
            font-weight: 700;
            color: var(--dark);
            transition: var(--transition);
        }

        /* 概览详情（二级菜单） */
        .overview-details {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            background: white;
            padding: 0 15px;
            border-bottom: 1px solid var(--border);
            transition: var(--expand-transition);
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .overview-details.active {
            max-height: 2000px;
            opacity: 1;
            padding: 15px;
        }

        .details-section {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--light-gray);
        }

        .details-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .details-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 10px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--primary-light);
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
            justify-items: center;
        }

        .details-item {
            padding: 10px 12px;
            background: #f9fafb;
            border-radius: 8px;
            transition: var(--transition);
            width: 100%;
        }

        .details-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .details-item-label {
            font-size: 12px;
            color: var(--gray);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .details-item-label i {
            font-size: 11px;
            color: var(--primary);
        }

        .details-item-value {
            font-size: 14px;
            font-weight: 500;
        }

        .details-list {
            padding-left: 5px;
            max-width: 800px;
            margin: 0 auto;
        }

        .details-list li {
            list-style: none;
            padding: 6px 0;
            font-size: 14px;
            display: flex;
            align-items: flex-start;
            gap: 8px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.03);
        }

        .details-list li:last-child {
            border-bottom: none;
        }

        .details-list li:before {
            content: "•";
            color: var(--primary);
            font-size: 16px;
            line-height: 1.2;
        }

        /* 主容器 */
        .main-container {
            background: white;
            padding: 20px 15px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* 阶段菜单（一级菜单） */
        .stage-menu {
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }

        .stage-item {
            background: white;
            border-bottom: 1px solid var(--border);
            transition: var(--transition);
        }

        .stage-item:last-child {
            border-bottom: none;
        }

        .stage-item:hover {
            border-color: rgba(22, 93, 255, 0.2);
        }

        .stage-item.viewing {
            border-left: 4px solid var(--primary);
            box-shadow: 0 4px 12px rgba(22, 93, 255, 0.1);
        }

        /* 阶段标题（可点击展开/折叠） */
        .stage-title {
            padding: 14px 15px;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .stage-title::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            transform: scaleY(0);
            transition: var(--transition);
        }

        .title-depart::after {
            background-color: var(--depart);
        }

        .title-stay::after {
            background-color: var(--stay);
        }

        .title-return::after {
            background-color: var(--return);
        }

        .stage-item.active .stage-title::after {
            transform: scaleY(1);
        }

        .stage-title:hover {
            opacity: 0.95;
            padding-left: 18px;
        }

        .title-depart {
            background: var(--depart-light);
            color: var(--depart);
        }

        .title-depart:hover {
            background: rgba(0, 180, 42, 0.12);
        }

        .title-stay {
            background: var(--stay-light);
            color: var(--stay);
        }

        .title-stay:hover {
            background: rgba(255, 125, 0, 0.12);
        }

        .title-return {
            background: var(--return-light);
            color: var(--return);
        }

        .title-return:hover {
            background: rgba(22, 140, 255, 0.12);
        }

        .stage-icon {
            font-size: 16px;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 展开时旋转图标 */
        .stage-item.active .stage-icon {
            transform: rotate(180deg);
        }

        /* 二级菜单（每日行程，默认隐藏） */
        .day-list {
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: var(--expand-transition);
            padding: 0;
        }

        /* 激活状态显示二级菜单 */
        .stage-item.active .day-list {
            max-height: 10000px; /* 设置一个足够大的值以容纳内容 */
            opacity: 1;
            padding: 8px 0;
        }

        /* 每日行程卡片（二级菜单内容） */
        .day-card {
            padding: 12px 15px;
            border-bottom: 1px dashed var(--light-gray);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            max-width: 900px;
            margin: 0 auto;
            will-change: transform;
            transform: translateZ(0);
        }

        .day-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background-color: transparent;
            transition: var(--transition);
        }

        .day-card:last-child {
            border-bottom: none;
        }

        .day-card:hover {
            background-color: #f9fafb;
            transform: translateX(5px);
        }

        .day-card:hover::before {
            background-color: var(--primary);
        }

        .day-card.highlight {
            background-color: rgba(22, 93, 255, 0.05);
            border-left: 3px solid var(--primary);
            transform: translateX(2px);
        }

        .day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 15px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .day-number {
            color: var(--primary);
            background: var(--primary-light);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 13px;
        }

        .day-route {
            flex: 1;
            margin: 0 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 14px;
            text-align: center;
        }

        /* 行程详情网格布局 - 移动端优化 */
        .day-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
            gap: 8px;
            font-size: 13px;
            margin-bottom: 6px;
            justify-items: center;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            padding: 5px 0;
            width: 100%;
            text-align: center;
        }

        .detail-label {
            color: var(--gray);
            margin-bottom: 3px;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 5px;
            justify-content: center;
        }

        .detail-label i {
            font-size: 10px;
        }

        .detail-value {
            font-weight: 500;
        }

        .value-cost {
            color: #FF4D4F;
            font-weight: 600;
        }

        /* 备注 */
        .day-note {
            display: flex;
            align-items: center;
            gap: 6px;
            color: var(--gray);
            font-size: 12px;
            margin-top: 6px;
            padding-top: 6px;
            border-top: 1px solid rgba(0, 0, 0, 0.03);
            justify-content: center;
        }

        .note-icon {
            font-size: 12px;
            color: var(--primary);
        }

        /* 底部提示 */
        .footer-tip {
            text-align: center;
            padding: 15px;
            font-size: 12px;
            color: var(--gray);
            background: white;
            border-top: 1px solid var(--border);
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* 搜索结果提示 */
        .search-result-notice {
            position: fixed;
            top: 75px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary);
            color: white;
            padding: 10px 18px;
            border-radius: 6px;
            font-size: 14px;
            z-index: 1500;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            box-shadow: 0 4px 15px rgba(22, 93, 255, 0.3);
            transform: translate(-50%, -20px);
        }

        .search-result-notice.show {
            opacity: 1;
            transform: translate(-50%, 0);
        }

        /* 顶部信息栏 */
        .info-bar {
            background: white;
            padding: 12px 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-bottom: 1px solid var(--border);
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
            flex-wrap: wrap;
            gap: 10px;
        }

        .info-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .tag-depart {
            background: var(--depart-light);
            color: var(--depart);
        }

        .tag-stay {
            background: var(--stay-light);
            color: var(--stay);
        }

        .tag-return {
            background: var(--return-light);
            color: var(--return);
        }

        /* 新增：进度条 */
        .progress-bar {
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.5s ease;
        }

        /* 新增：天气信息 */
        .weather-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--primary-light);
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 13px;
        }

        /* 新增：紧急联系人 */
        .emergency-contacts {
            padding: 12px;
            background: #fff8f8;
            border-radius: 8px;
            margin-top: 12px;
        }

        .emergency-contacts h3 {
            color: #ff4d4f;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .emergency-contacts ul {
            list-style: none;
        }

        .emergency-contacts li {
            padding: 4px 0;
            border-bottom: 1px dashed #ffcccc;
        }

        .emergency-contacts li:last-child {
            border-bottom: none;
        }

        /* 新增：错误提示 */
        .error-message {
            position: fixed;
            top: 75px;
            right: 15px;
            background: #ff4d4f;
            color: white;
            padding: 10px 14px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(255, 77, 79, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1600;
            animation: slideIn 0.3s ease;
        }

        .error-message button {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* 新增：搜索建议 */
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 8px;
            box-shadow: var(--shadow-hover);
            z-index: 1100;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .search-suggestions.active {
            display: block;
        }

        .suggestion-item {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid var(--border);
        }

        .suggestion-item:hover {
            background: var(--primary-light);
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        /* 新增：分享按钮 */
        .share-buttons {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            justify-content: center;
        }

        .share-button {
            padding: 6px 12px;
            border-radius: 20px;
            background: var(--primary-light);
            color: var(--primary);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            transition: var(--transition);
        }

        .share-button:hover {
            background: var(--primary);
            color: white;
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: var(--white);
            margin: 5% auto;
            padding: 0;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: var(--shadow-hover);
        }

        .modal-header {
            padding: 15px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--dark);
            font-size: 18px;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 22px;
            cursor: pointer;
            color: var(--gray);
        }

        .modal-body {
            padding: 15px;
            max-height: calc(80vh - 140px);
            overflow-y: auto;
        }

        /* 标签页样式 */
        .tab-nav {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 15px;
            overflow-x: auto;
            white-space: nowrap;
        }

        .tab-btn {
            padding: 10px 15px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
        }

        .tab-btn.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* 表单样式 */
        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--dark);
            font-size: 14px;
        }

        .form-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            transition: var(--transition);
        }

        .form-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(22, 93, 255, 0.1);
        }

        /* 按钮样式 */
        .modal-actions {
            display: flex;
            gap: 8px;
            justify-content: flex-end;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid var(--border);
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: var(--transition);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--light-gray);
            color: var(--dark);
        }

        .btn-secondary:hover {
            background: var(--gray);
            color: white;
        }

        /* 每日行程编辑器 */
        .days-editor {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 15px;
        }

        .day-selector select {
            height: 200px;
        }

        .day-editor-form {
            display: flex;
            flex-direction: column;
        }

        /* 消息提示 */
        .message {
            position: fixed;
            top: 75px;
            right: 15px;
            padding: 10px 14px;
            border-radius: 6px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 1600;
            animation: slideIn 0.3s ease;
        }

        .message.success {
            background: #00B42A;
            color: white;
        }

        .message.error {
            background: #FF4D4F;
            color: white;
        }

        .message.info {
            background: var(--primary);
            color: white;
        }

        .message button {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
            cursor: pointer;
        }

        /* 统计信息样式 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin: 12px 0;
        }

        .stat-item {
            background: var(--primary-light);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: var(--gray);
        }

        /* 响应式设计 - 移动端优化 */
        @media (max-width: 768px) {
            body {
                padding-top: 50px;
            }

            .navbar {
                height: 50px;
                padding: 0 10px;
            }

            .logo {
                font-size: 16px;
            }

            .logo i {
                font-size: 18px;
            }

            .search-container {
                display: none;
            }

            .mobile-search-btn {
                display: block;
            }

            .share-buttons {
                display: none;
            }

            .mobile-share-buttons {
                display: flex;
                gap: 8px;
            }

            .mobile-share-button {
                background: none;
                border: none;
                color: var(--gray);
                font-size: 18px;
                cursor: pointer;
            }

            .overview {
                padding: 10px 8px;
                gap: 8px;
            }

            .overview-card {
                min-width: 70px;
                max-width: 100px;
                padding: 10px 5px;
            }

            .overview-icon {
                font-size: 16px;
                margin-bottom: 4px;
            }

            .overview-label {
                font-size: 10px;
            }

            .overview-value {
                font-size: 13px;
            }

            .header {
                padding: 20px 10px 15px;
            }

            h1 {
                font-size: 18px;
            }

            .subtitle {
                font-size: 12px;
                gap: 10px;
            }

            .main-container {
                padding: 15px 10px;
            }

            .stage-title {
                padding: 12px 10px;
                font-size: 15px;
            }

            .day-card {
                padding: 10px 12px;
            }

            .day-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }

            .day-route {
                margin: 5px 0;
                text-align: left;
                width: 100%;
                white-space: normal;
                overflow: visible;
                text-overflow: unset;
            }

            .day-details {
                grid-template-columns: 1fr;
                gap: 6px;
            }

            .detail-item {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                text-align: left;
                padding: 4px 0;
            }

            .detail-label {
                margin-bottom: 0;
            }

            .details-grid {
                grid-template-columns: 1fr;
            }

            .info-bar {
                flex-wrap: wrap;
                gap: 8px;
                justify-content: center;
                padding: 10px;
            }

            .info-tag {
                margin-right: 0;
                font-size: 11px;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
            }

            .days-editor {
                grid-template-columns: 1fr;
            }

            .tab-nav {
                flex-wrap: nowrap;
                overflow-x: auto;
            }

            .tab-btn {
                flex: 1;
                min-width: 100px;
                font-size: 13px;
                padding: 8px 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .weather-info {
                font-size: 12px;
                padding: 6px 10px;
            }
        }

        /* 小屏幕手机优化 */
        @media (max-width: 480px) {
            .overview-card {
                min-width: 65px;
                max-width: 85px;
                padding: 8px 4px;
            }

            .overview-icon {
                font-size: 14px;
            }

            .overview-value {
                font-size: 12px;
            }

            .day-number {
                font-size: 12px;
            }

            .day-route {
                font-size: 13px;
            }

            .detail-label, .detail-value {
                font-size: 12px;
            }

            .day-note {
                font-size: 11px;
            }

            .footer-tip {
                font-size: 11px;
                padding: 10px;
            }
        }

        /* PC端优化 */
        @media (min-width: 1024px) {
            .navbar-content {
                justify-content: flex-start;
            }

            .share-buttons {
                margin-left: auto;
                margin-top: 0;
            }
        }
    </style>
</head>
<body>
<!-- 导航栏 -->
<nav class="navbar">
    <div class="navbar-content">
        <div class="logo">
            <i class="fas fa-motorcycle"></i>
            <span>机车旅行</span>
        </div>

        <!-- PC端搜索框 -->
        <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-input" placeholder="搜索地点、景点或路线...">
            <div class="search-suggestions">
                <!-- 搜索建议将通过JS动态生成 -->
            </div>
        </div>

        <!-- PC端分享按钮 -->
        <div class="share-buttons">
            <button class="share-button" id="manageData">
                <i class="fas fa-database"></i>数据管理
            </button>
            <button class="share-button" id="shareWechat">
                <i class="fab fa-weixin"></i>微信
            </button>
            <button class="share-button" id="printTrip">
                <i class="fas fa-print"></i>打印
            </button>
        </div>

        <!-- 移动端搜索按钮 -->
        <button class="mobile-search-btn">
            <i class="fas fa-search"></i>
        </button>

        <!-- 移动端分享按钮 -->
        <div class="mobile-share-buttons">
            <button class="mobile-share-button" id="mobileManageData">
                <i class="fas fa-database"></i>
            </button>
            <button class="mobile-share-button" id="mobileShareWechat">
                <i class="fab fa-weixin"></i>
            </button>
        </div>
    </div>
</nav>

<!-- 移动端搜索模态框 -->
<div class="mobile-search-modal">
    <div class="mobile-search-header">
        <input type="text" class="mobile-search-input" placeholder="搜索地点、景点或路线...">
        <button class="mobile-search-close">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="mobile-search-suggestions">
        <!-- 移动端搜索建议将通过JS动态生成 -->
    </div>
</div>

<!-- 数据管理模态框 -->
<div id="dataModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>行程数据管理</h3>
            <button class="close-modal">&times;</button>
        </div>
        <div class="modal-body">
            <!-- 标签页导航 -->
            <div class="tab-nav">
                <button class="tab-btn active" data-tab="basic">基础信息</button>
                <button class="tab-btn" data-tab="days">每日行程</button>
                <button class="tab-btn" data-tab="stats">行程统计</button>
                <button class="tab-btn" data-tab="import">导入/导出</button>
            </div>

            <!-- 基础信息标签页 -->
            <div class="tab-content active" id="basic-tab">
                <div class="form-group">
                    <label>行程标题</label>
                    <input type="text" id="editTitle" class="form-input">
                </div>
                <div class="form-group">
                    <label>总天数</label>
                    <input type="number" id="editTotalDays" class="form-input">
                </div>
                <div class="form-group">
                    <label>总里程 (km)</label>
                    <input type="number" id="editTotalMileage" class="form-input" step="0.1">
                </div>
                <div class="form-group">
                    <label>总费用</label>
                    <input type="text" id="editTotalCost" class="form-input">
                </div>
            </div>

            <!-- 每日行程标签页 -->
            <div class="tab-content" id="days-tab">
                <div class="days-editor">
                    <div class="day-selector">
                        <select id="daySelect" class="form-input" size="10">
                            <!-- 天数选项将通过JS动态生成 -->
                        </select>
                    </div>
                    <div class="day-editor-form">
                        <div class="form-group">
                            <label>路线描述</label>
                            <input type="text" id="editDayRoute" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>当日里程 (km)</label>
                            <input type="number" id="editDayMileage" class="form-input" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>当日开支</label>
                            <input type="text" id="editDayCost" class="form-input">
                        </div>
                        <div class="form-group">
                            <label>备注信息</label>
                            <textarea id="editDayNote" class="form-input" rows="3"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 行程统计标签页 -->
            <div class="tab-content" id="stats-tab">
                <div class="stats-grid" id="statsContainer">
                    <!-- 统计信息将通过JS动态生成 -->
                </div>
                <div class="form-group">
                    <h4>阶段统计</h4>
                    <div id="stageStats">
                        <!-- 阶段统计信息将通过JS动态生成 -->
                    </div>
                </div>
            </div>

            <!-- 导入导出标签页 -->
            <div class="tab-content" id="import-tab">
                <div class="import-export-section">
                    <div class="form-group">
                        <h4>导出数据</h4>
                        <p>将当前行程数据导出为JSON文件</p>
                        <button class="btn btn-primary" id="exportData">
                            <i class="fas fa-download"></i> 导出数据
                        </button>
                    </div>

                    <div class="form-group">
                        <h4>导入数据</h4>
                        <p>从JSON文件导入行程数据</p>
                        <input type="file" id="importFile" accept=".json" class="form-input">
                        <button class="btn btn-secondary" id="importData">
                            <i class="fas fa-upload"></i> 导入数据
                        </button>
                    </div>

                    <div class="form-group">
                        <h4>数据模板</h4>
                        <p>使用预设模板快速开始</p>
                        <div class="template-buttons">
                            <button class="btn btn-secondary" id="useTemplate1">
                                西藏之旅模板
                            </button>
                            <button class="btn btn-secondary" id="useTemplate2">
                                沿海环线模板
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 操作按钮 -->
            <div class="modal-actions">
                <button class="btn btn-secondary" id="resetData">重置数据</button>
                <button class="btn btn-primary" id="saveData">保存修改</button>
            </div>
        </div>
    </div>
</div>

<!-- 搜索结果提示 -->
<div class="search-result-notice" id="searchNotice"></div>

<!-- 顶部Header -->
<div class="header">
    <div class="header-content">
        <span class="trip-tag" id="tripTag">机车旅行 · 19天</span>
        <h1 id="mainTitle">常德 → 拉萨 往返行程</h1>
        <p class="subtitle" id="mainSubtitle">
            <span>总里程 6790.1km</span>
            <span>单人预算 6007-6456元</span>
        </p>
    </div>
</div>

<!-- 天气信息 -->
<div class="weather-info">
    <i class="fas fa-sun"></i>
    <span>当前温度：15°C | 建议着装：保暖内衣+冲锋衣</span>
</div>

<!-- 信息概览栏 -->
<div class="info-bar" id="infoBar">
    <!-- 信息栏将通过JS动态生成 -->
</div>

<!-- 行程概览 -->
<div class="overview">
    <div class="overview-card" id="overview-mileage">
        <div class="overview-icon"><i class="fas fa-road"></i></div>
        <div class="overview-label">总里程</div>
        <div class="overview-value" id="overviewMileageValue">6790.1km</div>
    </div>
    <div class="overview-card" id="overview-days">
        <div class="overview-icon"><i class="fas fa-calendar-alt"></i></div>
        <div class="overview-label">总天数</div>
        <div class="overview-value" id="overviewDaysValue">19天</div>
    </div>
    <div class="overview-card" id="overview-cost">
        <div class="overview-icon"><i class="fas fa-coins"></i></div>
        <div class="overview-label">总费用</div>
        <div class="overview-value" id="overviewCostValue">6007-6456元</div>
    </div>
    <div class="overview-card" id="overview-attractions">
        <div class="overview-icon"><i class="fas fa-mountain"></i></div>
        <div class="overview-label">核心景点</div>
        <div class="overview-value" id="overviewAttractionsValue">布达拉宫</div>
    </div>
    <div class="overview-card" id="overview-checkin">
        <div class="overview-icon"><i class="fas fa-snowflake"></i></div>
        <div class="overview-label">特色打卡</div>
        <div class="overview-value" id="overviewCheckinValue">纳木错</div>
    </div>
</div>

<!-- 概览详情（二级菜单） -->
<div class="overview-details" id="mileage-details">
    <!-- 里程详情将通过JS动态更新 -->
</div>

<div class="overview-details" id="days-details">
    <!-- 天数详情将通过JS动态更新 -->
</div>

<div class="overview-details" id="cost-details">
    <!-- 费用详情将通过JS动态更新 -->
</div>

<div class="overview-details" id="attractions-details">
    <!-- 景点详情将通过JS动态更新 -->
</div>

<div class="overview-details" id="checkin-details">
    <!-- 打卡详情将通过JS动态更新 -->
</div>

<!-- 主内容区（二级菜单） -->
<div class="main-container">
    <div class="stage-menu" id="stageMenu">
        <!-- 阶段菜单将通过JS动态生成 -->
    </div>
</div>

<!-- 底部提示 -->
<div class="footer-tip">
    本行程仅供参考，实际出行请根据天气、路况等因素灵活调整 | 高原旅行请做好防护措施
</div>
<!-- 回到顶部按钮 -->
<div class="back-to-top" id="backToTop">
    <i class="fas fa-chevron-up"></i>
</div>
<script>
    // 回到顶部功能
    const backToTopBtn = document.getElementById('backToTop');

    // 监听滚动事件
    window.addEventListener('scroll', function() {
        if (window.pageYOffset > 300) {
            backToTopBtn.classList.add('show');
        } else {
            backToTopBtn.classList.remove('show');
        }
    });

    // 点击回到顶部
    backToTopBtn.addEventListener('click', function() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    });
    // 行程数据管理器
    const TripDataManager = {
        // 默认数据
        defaultData: {
            // 基础信息
            title: "常德 → 拉萨机车旅行",
            totalDays: 19,
            totalMileage: 6790.1,
            totalCost: "6007-6456元",

            // 阶段信息
            stages: {
                depart: { name: "去程阶段", days: 8, color: "depart" },
                stay: { name: "停留阶段", days: 1, color: "stay" },
                return: { name: "返程阶段", days: 10, color: "return" }
            },

            // 每日行程数据
            days: [
                // 去程阶段
                { stage: "depart", day: 1, route: "常德→洪崖洞（重庆）", mileage: 636.7, cost: "338-388元", note: "重庆休整，适应气候" },
                { stage: "depart", day: 2, route: "洪崖洞→摩域乐迹机车俱乐部", mileage: 330.9, cost: "296-346元", note: "车辆免费检查，无需整备" },
                { stage: "depart", day: 3, route: "摩域乐迹机车俱乐部→康定", mileage: 252.4, cost: "285-310元", note: "明日翻折多山，提前休息" },
                { stage: "depart", day: 4, route: "康定→巴塘县人民政府", mileage: 444.2, cost: "311-336元", note: "高海拔路段，备应急物资" },
                { stage: "depart", day: 5, route: "巴塘县→八宿县人民政府", mileage: 455.5, cost: "313-338元", note: "长下坡路段，控制车速" },
                { stage: "depart", day: 6, route: "八宿县→波密县人民政府", mileage: 217.6, cost: "280-305元", note: "通麦天险路段，注意落石" },
                { stage: "depart", day: 7, route: "波密县→林芝市人民政府", mileage: 227.3, cost: "281-306元", note: "林芝海拔较低，缓解高反" },
                { stage: "depart", day: 8, route: "林芝市→布达拉宫（拉萨）", mileage: 397.4, cost: "355元", note: "去程终点，次日休整" },

                // 停留阶段
                { stage: "stay", day: 9, route: "拉萨市内休整", mileage: 0, cost: "350-400元", note: "游览布达拉宫，适应高原气候" },

                // 返程阶段
                { stage: "return", day: 10, route: "布达拉宫→那曲市人民政府", mileage: 403.0, cost: "425-450元", note: "纳木错打卡，注意保暖" },
                { stage: "return", day: 11, route: "那曲市→丁青县人民政府", mileage: 476.2, cost: "316-341元", note: "317国道海拨较高，匀速骑行" },
                { stage: "return", day: 12, route: "丁青县→昌都市人民政府", mileage: 231.1, cost: "282-307元", note: "市区补料，检查车辆轮胎" },
                { stage: "return", day: 13, route: "昌都市→德格县人民政府", mileage: 323.5, cost: "295-320元", note: "沿途多翻山，谨慎驾驶" },
                { stage: "return", day: 14, route: "德格县→炉霍县人民政府", mileage: 277.0, cost: "288-313元", note: "路况较好，可适当观景" },
                { stage: "return", day: 15, route: "炉霍县→汶川县人民政府", mileage: 472.3, cost: "315-340元", note: "长距离骑骋，注意休息" },
                { stage: "return", day: 16, route: "汶川县→自贡市人民政府", mileage: 367.9, cost: "300-325元", note: "自贡特色美食，适度体验" },
                { stage: "return", day: 17, route: "自贡市→贵阳市人民政府", mileage: 498.2, cost: "319-344元", note: "高速路段，遵守限速" },
                { stage: "return", day: 18, route: "贵阳市→怀化市人民政府", mileage: 466.4, cost: "314-339元", note: "山区路段，注意弯道会车" },
                { stage: "return", day: 19, route: "怀化市→石门桥镇", mileage: 312.5, cost: "193元", note: "平安到家，行程结束" }
            ],

            // 概览数据
            overview: {
                mileage: {
                    title: "总里程",
                    value: "6790.1km",
                    details: {
                        departMileage: "2962.0km (43.6%)",
                        returnMileage: "3828.1km (56.4%)",
                        dailyAverage: "367.5km/天",
                        maxDaily: "636.7km (第1天)",
                        minDaily: "0km (第9天，休整)",
                        highAltitude: "约1850km (海拔3000m+)"
                    }
                },
                days: {
                    title: "总天数",
                    value: "19天",
                    details: {
                        departDays: "8天 (42.1%)",
                        returnDays: "10天 (52.6%)",
                        stayDays: "1天 (5.3%)",
                        dailyRidingHours: "6-8小时",
                        bestSeason: "5-6月、9-10月"
                    }
                },
                cost: {
                    title: "总费用",
                    value: "6007-6456元",
                    details: {
                        fuel: "约2250元 (35-38%)",
                        accommodation: "约2100元 (33-35%)",
                        food: "约1200元 (19-20%)",
                        tickets: "约500元 (8-9%)",
                        maintenance: "约200元 (3-4%)",
                        emergency: "建议1000元"
                    }
                },
                attractions: {
                    title: "核心景点",
                    value: "布达拉宫",
                    details: {
                        mainAttractions: "布达拉宫、大昭寺、八廓街、纳木错、羊卓雍措",
                        mustVisit: "布达拉宫（需提前预约）、大昭寺",
                        recommended: "纳木错（观星）、羊卓雍措（摄影）",
                        tips: "布达拉宫门票需提前7天预约，纳木错海拔较高注意高反"
                    }
                },
                checkin: {
                    title: "特色打卡",
                    value: "纳木错",
                    details: {
                        scenicSpots: "纳木错、米拉山口、折多山、通麦天险、怒江72拐",
                        photoTips: "纳木错日出、米拉山口经幡、怒江72拐全景",
                        bestTime: "纳木错：清晨或傍晚；米拉山口：晴天上午",
                        equipment: "建议携带广角镜头、三脚架、偏振镜"
                    }
                }
            },

            // 用户设置
            settings: {
                currency: "元",
                distanceUnit: "km",
                showWeather: true,
                autoSave: true
            }
        },

        // 当前数据
        data: null,

        // 初始化
        init() {
            this.loadData();
            this.setupEventListeners();
            this.renderAll();
        },

        // 加载数据
        loadData() {
            const saved = localStorage.getItem('tripData');
            if (saved) {
                this.data = JSON.parse(saved);
                this.showMessage('已加载保存的数据', 'success');
            } else {
                this.data = JSON.parse(JSON.stringify(this.defaultData));
                this.saveData();
                this.showMessage('使用默认数据', 'info');
            }
            return this.data;
        },

        // 保存数据
        saveData() {
            localStorage.setItem('tripData', JSON.stringify(this.data));
            this.showMessage('数据已保存', 'success');
        },

        // 重置数据
        resetData() {
            if (confirm('确定要重置所有数据吗？这将清除所有自定义修改。')) {
                this.data = JSON.parse(JSON.stringify(this.defaultData));
                this.saveData();
                this.renderAll();
                this.showMessage('数据已重置', 'success');
            }
        },

        // 设置事件监听器
        setupEventListeners() {
            // 数据管理按钮
            document.getElementById('manageData').addEventListener('click', () => {
                this.openModal();
            });

            // 移动端数据管理按钮
            document.getElementById('mobileManageData').addEventListener('click', () => {
                this.openModal();
            });

            // 关闭模态框
            document.querySelector('.close-modal').addEventListener('click', () => {
                this.closeModal();
            });

            // 标签页切换
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    this.switchTab(e.target.dataset.tab);
                });
            });

            // 保存数据
            document.getElementById('saveData').addEventListener('click', () => {
                this.saveFromForm();
            });

            // 重置数据
            document.getElementById('resetData').addEventListener('click', () => {
                this.resetData();
            });

            // 天数选择
            document.getElementById('daySelect').addEventListener('change', (e) => {
                this.loadDayData(parseInt(e.target.value));
            });

            // 导出数据
            document.getElementById('exportData').addEventListener('click', () => {
                this.exportData();
            });

            // 导入数据
            document.getElementById('importData').addEventListener('click', () => {
                this.importData();
            });

            // 使用模板
            document.getElementById('useTemplate1').addEventListener('click', () => {
                this.useTemplate('tibet');
            });

            document.getElementById('useTemplate2').addEventListener('click', () => {
                this.useTemplate('coastal');
            });

            // 点击模态框外部关闭
            document.getElementById('dataModal').addEventListener('click', (e) => {
                if (e.target.id === 'dataModal') {
                    this.closeModal();
                }
            });

            // 移动端搜索功能
            document.querySelector('.mobile-search-btn').addEventListener('click', () => {
                document.querySelector('.mobile-search-modal').classList.add('active');
            });

            document.querySelector('.mobile-search-close').addEventListener('click', () => {
                document.querySelector('.mobile-search-modal').classList.remove('active');
            });

            // 移动端搜索
            document.querySelector('.mobile-search-input').addEventListener('input', function() {
                const searchTerm = this.value.trim().toLowerCase();
                if (searchTerm) {
                    const searchTerms = [
                        '常德', '洪崖洞', '重庆', '摩域乐迹机车俱乐部', '康定',
                        '巴塘县', '八宿县', '波密县', '林芝市', '布达拉宫', '拉萨',
                        '那曲市', '丁青县', '昌都市', '德格县', '炉霍县', '汶川县',
                        '自贡市', '贵阳市', '怀化市', '石门桥镇', '纳木错'
                    ];

                    const filteredTerms = searchTerms.filter(term =>
                        term.toLowerCase().includes(searchTerm)
                    );

                    const suggestionsContainer = document.querySelector('.mobile-search-suggestions');
                    if (filteredTerms.length > 0) {
                        suggestionsContainer.innerHTML = filteredTerms.map(term =>
                            `<div class="suggestion-item">${term}</div>`
                        ).join('');
                    } else {
                        suggestionsContainer.innerHTML = '<div class="suggestion-item">无匹配结果</div>';
                    }
                } else {
                    document.querySelector('.mobile-search-suggestions').innerHTML = '';
                }
            });

            // 移动端搜索建议点击
            document.querySelector('.mobile-search-suggestions').addEventListener('click', function(e) {
                if (e.target.classList.contains('suggestion-item')) {
                    const searchTerm = e.target.textContent;
                    document.querySelector('.mobile-search-modal').classList.remove('active');
                    performSearch(searchTerm);
                }
            });

            // 移动端搜索回车
            document.querySelector('.mobile-search-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const searchTerm = this.value.trim();
                    if (searchTerm) {
                        document.querySelector('.mobile-search-modal').classList.remove('active');
                        performSearch(searchTerm);
                    }
                }
            });
        },

        // 打开模态框
        openModal() {
            document.getElementById('dataModal').style.display = 'block';
            this.loadFormData();
            this.updateStatistics(); // 打开时更新统计信息
        },

        // 关闭模态框
        closeModal() {
            document.getElementById('dataModal').style.display = 'none';
        },

        // 切换标签页
        switchTab(tabName) {
            // 更新按钮状态
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // 更新内容显示
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`${tabName}-tab`).classList.add('active');

            // 如果是统计标签页，更新统计信息
            if (tabName === 'stats') {
                this.updateStatistics();
            }
        },

        // 加载表单数据
        loadFormData() {
            // 基础信息
            document.getElementById('editTitle').value = this.data.title;
            document.getElementById('editTotalDays').value = this.data.totalDays;
            document.getElementById('editTotalMileage').value = this.data.totalMileage;
            document.getElementById('editTotalCost').value = this.data.totalCost;

            // 初始化天数选择器
            this.initDaySelector();

            // 加载第一天数据
            if (this.data.days.length > 0) {
                this.loadDayData(1);
            }
        },

        // 初始化天数选择器
        initDaySelector() {
            const daySelect = document.getElementById('daySelect');
            daySelect.innerHTML = '';

            this.data.days.forEach(day => {
                const option = document.createElement('option');
                option.value = day.day;
                option.textContent = `第${day.day}天: ${day.route.substring(0, 30)}${day.route.length > 30 ? '...' : ''}`;
                daySelect.appendChild(option);
            });
        },

        // 加载单日数据
        loadDayData(dayNumber) {
            const dayData = this.data.days.find(d => d.day === dayNumber);
            if (dayData) {
                document.getElementById('editDayRoute').value = dayData.route;
                document.getElementById('editDayMileage').value = dayData.mileage;
                document.getElementById('editDayCost').value = dayData.cost;
                document.getElementById('editDayNote').value = dayData.note;
            }
        },

        // 从表单保存数据
        saveFromForm() {
            // 保存基础信息
            this.data.title = document.getElementById('editTitle').value;
            this.data.totalDays = parseInt(document.getElementById('editTotalDays').value);
            this.data.totalMileage = parseFloat(document.getElementById('editTotalMileage').value);
            this.data.totalCost = document.getElementById('editTotalCost').value;

            // 保存当前编辑的天数数据
            const currentDay = parseInt(document.getElementById('daySelect').value);
            const dayData = this.data.days.find(d => d.day === currentDay);
            if (dayData) {
                dayData.route = document.getElementById('editDayRoute').value;
                dayData.mileage = parseFloat(document.getElementById('editDayMileage').value);
                dayData.cost = document.getElementById('editDayCost').value;
                dayData.note = document.getElementById('editDayNote').value;
            }

            // 重新计算统计数据
            this.calculateStatistics();

            this.saveData();
            this.renderAll();
            this.closeModal();
        },

        // 计算统计数据
        calculateStatistics() {
            const stats = this.calculateStageStats();

            // 更新概览数据
            this.data.overview.mileage.value = `${this.data.totalMileage}km`;
            this.data.overview.days.value = `${this.data.totalDays}天`;
            this.data.overview.cost.value = this.data.totalCost;

            // 更新里程详情
            this.data.overview.mileage.details = {
                departMileage: `${stats.departMileage}km (${stats.departPercentage}%)`,
                returnMileage: `${stats.returnMileage}km (${stats.returnPercentage}%)`,
                dailyAverage: `${stats.dailyAverage}km/天`,
                maxDaily: `${stats.maxDaily.mileage}km (第${stats.maxDaily.day}天)`,
                minDaily: `${stats.minDaily.mileage}km (第${stats.minDaily.day}天)`,
                highAltitude: `约${Math.round(stats.totalMileage * 0.27)}km (海拔3000m+)` // 估算值
            };
        },

        // 计算阶段统计
        calculateStageStats() {
            const departDays = this.data.days.filter(d => d.stage === 'depart');
            const stayDays = this.data.days.filter(d => d.stage === 'stay');
            const returnDays = this.data.days.filter(d => d.stage === 'return');

            const departMileage = departDays.reduce((sum, day) => sum + day.mileage, 0);
            const returnMileage = returnDays.reduce((sum, day) => sum + day.mileage, 0);
            const totalMileage = departMileage + returnMileage;

            const departPercentage = ((departMileage / totalMileage) * 100).toFixed(1);
            const returnPercentage = ((returnMileage / totalMileage) * 100).toFixed(1);

            // 找到最长和最短单日里程
            const allDays = [...this.data.days];
            const maxDaily = allDays.reduce((max, day) => day.mileage > max.mileage ? day : max, {mileage: 0, day: 0});
            const minDaily = allDays.reduce((min, day) => day.mileage < min.mileage ? day : min, {mileage: Infinity, day: 0});

            const dailyAverage = (totalMileage / this.data.totalDays).toFixed(1);

            return {
                departMileage: departMileage.toFixed(1),
                returnMileage: returnMileage.toFixed(1),
                totalMileage: totalMileage.toFixed(1),
                departPercentage,
                returnPercentage,
                dailyAverage,
                maxDaily: { mileage: maxDaily.mileage, day: maxDaily.day },
                minDaily: { mileage: minDaily.mileage, day: minDaily.day }
            };
        },

        // 更新统计信息显示
        updateStatistics() {
            const stats = this.calculateStageStats();
            const statsContainer = document.getElementById('statsContainer');
            const stageStats = document.getElementById('stageStats');

            // 更新主要统计
            statsContainer.innerHTML = `
                <div class="stat-item">
                    <div class="stat-value">${stats.totalMileage}km</div>
                    <div class="stat-label">总里程</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.dailyAverage}km</div>
                    <div class="stat-label">日均里程</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.maxDaily.mileage}km</div>
                    <div class="stat-label">最长单日（第${stats.maxDaily.day}天）</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">${stats.minDaily.mileage}km</div>
                    <div class="stat-label">最短单日（第${stats.minDaily.day}天）</div>
                </div>
            `;

            // 更新阶段统计
            stageStats.innerHTML = `
                <div class="details-grid">
                    <div class="details-item">
                        <div class="details-item-label"><i class="fas fa-arrow-right"></i>去程里程</div>
                        <div class="details-item-value">${stats.departMileage}km (${stats.departPercentage}%)</div>
                    </div>
                    <div class="details-item">
                        <div class="details-item-label"><i class="fas fa-arrow-left"></i>返程里程</div>
                        <div class="details-item-value">${stats.returnMileage}km (${stats.returnPercentage}%)</div>
                    </div>
                </div>
            `;
        },

        // 渲染所有数据到界面
        renderAll() {
            this.renderHeader();
            this.renderInfoBar();
            this.renderOverview();
            this.renderStages();
            this.renderOverviewDetails();
        },

        // 渲染头部信息
        renderHeader() {
            document.getElementById('tripTag').textContent = `机车旅行 · ${this.data.totalDays}天`;
            document.getElementById('mainTitle').textContent = this.data.title;
            document.getElementById('mainSubtitle').innerHTML = `
                <span>总里程 ${this.data.totalMileage}km</span>
                <span>单人预算 ${this.data.totalCost}</span>
            `;
        },

        // 渲染信息栏
        renderInfoBar() {
            const stats = this.calculateStageStats();
            const infoBar = document.getElementById('infoBar');

            infoBar.innerHTML = `
                <div class="info-tag tag-depart">
                    <i class="fas fa-arrow-right"></i>
                    <span>去程：${this.data.stages.depart.days}天，${stats.departMileage}km</span>
                </div>
                <div class="info-tag tag-stay">
                    <i class="fas fa-pause"></i>
                    <span>停留：${this.data.stages.stay.days}天，休整</span>
                </div>
                <div class="info-tag tag-return">
                    <i class="fas fa-arrow-left"></i>
                    <span>返程：${this.data.stages.return.days}天，${stats.returnMileage}km</span>
                </div>
            `;
        },

        // 渲染概览卡片
        renderOverview() {
            document.getElementById('overviewMileageValue').textContent = this.data.overview.mileage.value;
            document.getElementById('overviewDaysValue').textContent = this.data.overview.days.value;
            document.getElementById('overviewCostValue').textContent = this.data.overview.cost.value;
            document.getElementById('overviewAttractionsValue').textContent = this.data.overview.attractions.value;
            document.getElementById('overviewCheckinValue').textContent = this.data.overview.checkin.value;
        },

        // 渲染阶段菜单
        renderStages() {
            const stageMenu = document.getElementById('stageMenu');
            stageMenu.innerHTML = '';

            // 为每个阶段创建HTML
            Object.entries(this.data.stages).forEach(([stageKey, stage]) => {
                const stageDays = this.data.days.filter(d => d.stage === stageKey);
                const stageElement = this.createStageElement(stageKey, stage, stageDays);
                stageMenu.appendChild(stageElement);
            });

            // 重新绑定事件
            this.bindStageEvents();
        },

        // 创建阶段元素
        createStageElement(stageKey, stage, days) {
            const stageDiv = document.createElement('div');
            stageDiv.className = 'stage-item';
            stageDiv.id = `stage-${stageKey}`;

            const stats = this.calculateStageStats();
            const stageMileage = stageKey === 'depart' ? stats.departMileage :
                stageKey === 'return' ? stats.returnMileage : '0';

            stageDiv.innerHTML = `
                <div class="stage-title title-${stageKey}">
                    <span>${stage.name}（${stage.days}天，${stageMileage}km）</span>
                    <i class="fas fa-chevron-down stage-icon"></i>
                </div>
                <div class="day-list">
                    ${days.map(day => this.createDayCard(day)).join('')}
                </div>
            `;

            return stageDiv;
        },

        // 创建单日行程卡片
        createDayCard(dayData) {
            const cumulativeMileage = this.calculateCumulativeMileage(dayData.day);
            const cumulativeCost = this.calculateCumulativeCost(dayData.day);

            return `
                <div class="day-card" data-day="${dayData.day}">
                    <div class="day-header">
                        <span class="day-number">第${dayData.day}天</span>
                        <span class="day-route">${dayData.route}</span>
                    </div>
                    <div class="day-details">
                        <div class="detail-item">
                            <div class="detail-label"><i class="fas fa-road"></i>当日里程</div>
                            <div class="detail-value">${dayData.mileage}km</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label"><i class="fas fa-tachometer-alt"></i>累计里程</div>
                            <div class="detail-value">${cumulativeMileage}km</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label"><i class="fas fa-coins"></i>当日开支</div>
                            <div class="detail-value value-cost">${dayData.cost}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label"><i class="fas fa-wallet"></i>累计开支</div>
                            <div class="detail-value value-cost">${cumulativeCost}</div>
                        </div>
                    </div>
                    <div class="day-note">
                        <i class="fas fa-bed note-icon"></i>
                        <span>${dayData.note}</span>
                    </div>
                </div>
            `;
        },

        // 绑定阶段事件
        bindStageEvents() {
            const stageTitles = document.querySelectorAll('.stage-title');
            stageTitles.forEach(title => {
                title.addEventListener('click', function() {
                    const stageItem = this.parentElement;
                    const isActive = stageItem.classList.contains('active');

                    if (isActive) {
                        stageItem.classList.remove('active');
                    } else {
                        document.querySelectorAll('.stage-item.active').forEach(item => {
                            if (item !== stageItem) {
                                item.classList.remove('active');
                            }
                        });
                        stageItem.classList.add('active');
                    }
                });
            });
        },

        // 渲染概览详情
        renderOverviewDetails() {
            this.renderMileageDetails();
            this.renderDaysDetails();
            this.renderCostDetails();
            this.renderAttractionsDetails();
            this.renderCheckinDetails();
        },

        // 渲染里程详情
        renderMileageDetails() {
            const stats = this.calculateStageStats();
            const mileageDetails = document.getElementById('mileage-details');

            mileageDetails.innerHTML = `
                <div class="details-section">
                    <h3 class="details-title"><i class="fas fa-chart-pie"></i>里程分布</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${stats.departPercentage}%"></div>
                    </div>
                    <div class="details-grid">
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-arrow-right"></i>去程里程</div>
                            <div class="details-item-value">${stats.departMileage}km (${stats.departPercentage}%)</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-arrow-left"></i>返程里程</div>
                            <div class="details-item-value">${stats.returnMileage}km (${stats.returnPercentage}%)</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-clock"></i>日均里程</div>
                            <div class="details-item-value">${stats.dailyAverage}km/天</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-tachometer-alt"></i>最长单日里程</div>
                            <div class="details-item-value">${stats.maxDaily.mileage}km (第${stats.maxDaily.day}天)</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-tachometer-alt-slow"></i>最短单日里程</div>
                            <div class="details-item-value">${stats.minDaily.mileage}km (第${stats.minDaily.day}天)</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-mountain"></i>高海拔路段</div>
                            <div class="details-item-value">约${Math.round(stats.totalMileage * 0.27)}km (海拔3000m+)</div>
                        </div>
                    </div>
                </div>
                <div class="details-section">
                    <h3 class="details-title"><i class="fas fa-route"></i>路线特点</h3>
                    <ul class="details-list">
                        <li>去程以318国道为主，风景秀丽但多山路</li>
                        <li>返程以317国道为主，路况复杂但人文景观丰富</li>
                        <li>途经12个地州市，跨越多条江河</li>
                        <li>翻越折多山、米拉山等10余座海拔4000m以上高山</li>
                        <li>包含高速路段约1200km，国道省道约${Math.round(stats.totalMileage - 1200)}km</li>
                    </ul>
                </div>
                <div class="details-section">
                    <h3 class="details-title"><i class="fas fa-bicycle"></i>骑行建议</h3>
                    <ul class="details-list">
                        <li>高海拔路段建议每天骑行不超过6小时，避免疲劳</li>
                        <li>318国道理塘至巴塘段需注意野生动物出没</li>
                        <li>317国道丁青至昌都段多落石，建议白天通行</li>
                        <li>每日出发前检查轮胎气压和刹车系统</li>
                        <li>携带备用油箱，部分路段加油站间距超过150km</li>
                    </ul>
                </div>
            `;
        },

        // 渲染天数详情
        renderDaysDetails() {
            const daysDetails = document.getElementById('days-details');
            const departPercentage = ((this.data.stages.depart.days / this.data.totalDays) * 100).toFixed(1);
            const returnPercentage = ((this.data.stages.return.days / this.data.totalDays) * 100).toFixed(1);
            const stayPercentage = ((this.data.stages.stay.days / this.data.totalDays) * 100).toFixed(1);

            daysDetails.innerHTML = `
                <div class="details-section">
                    <h3 class="details-title"><i class="fas fa-calendar-check"></i>行程时间分布</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${departPercentage}%"></div>
                    </div>
                    <div class="details-grid">
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-arrow-right"></i>去程天数</div>
                            <div class="details-item-value">${this.data.stages.depart.days}天 (${departPercentage}%)</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-arrow-left"></i>返程天数</div>
                            <div class="details-item-value">${this.data.stages.return.days}天 (${returnPercentage}%)</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-pause"></i>休整天数</div>
                            <div class="details-item-value">${this.data.stages.stay.days}天 (${stayPercentage}%)</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-clock"></i>平均每日骑行时间</div>
                            <div class="details-item-value">6-8小时</div>
                        </div>
                    </div>
                </div>
                <div class="details-section">
                    <h3 class="details-title"><i class="fas fa-sun"></i>最佳出行季节</h3>
                    <ul class="details-list">
                        <li>推荐5-6月、9-10月出行，避开7-8月雨季</li>
                        <li>5月可能遇到局部降雪，需携带防寒装备</li>
                        <li>6月气候适宜，草原开始变绿，景色优美</li>
                        <li>9-10月秋色迷人，降雨量少，路况稳定</li>
                        <li>冬季（11-4月）部分路段封闭，不建议前往</li>
                    </ul>
                </div>
            `;
        },

        // 渲染费用详情
        renderCostDetails() {
            const costDetails = document.getElementById('cost-details');

            costDetails.innerHTML = `
                <div class="details-section">
                    <h3 class="details-title"><i class="fas fa-wallet"></i>费用构成</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 38%"></div>
                    </div>
                    <div class="details-grid">
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-gas-pump"></i>燃油费用</div>
                            <div class="details-item-value">约2250元 (35-38%)</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-bed"></i>住宿费用</div>
                            <div class="details-item-value">约2100元 (33-35%)</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-utensils"></i>餐饮费用</div>
                            <div class="details-item-value">约1200元 (19-20%)</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-ticket-alt"></i>景点门票</div>
                            <div class="details-item-value">约500元 (8-9%)</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-tools"></i>车辆维护</div>
                            <div class="details-item-value">约200元 (3-4%)</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-exclamation-triangle"></i>应急备用金</div>
                            <div class="details-item-value">建议1000元</div>
                        </div>
                    </div>
                </div>
                <div class="details-section">
                    <h3 class="details-title"><i class="fas fa-percentage"></i>费用节省建议</h3>
                    <ul class="details-list">
                        <li>提前预订住宿可节省10-15%费用</li>
                        <li>携带露营装备可在部分路段节省住宿费</li>
                        <li>自备干粮减少途中餐饮开支</li>
                        <li>多人同行可平摊部分费用</li>
                        <li>关注景点门票优惠政策（如学生证、军人证等）</li>
                    </ul>
                </div>
            `;
        },

        // 渲染景点详情
        renderAttractionsDetails() {
            const attractionsDetails = document.getElementById('attractions-details');

            attractionsDetails.innerHTML = `
                <div class="details-section">
                    <h3 class="details-title"><i class="fas fa-map-marked-alt"></i>主要景点</h3>
                    <div class="details-grid">
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-landmark"></i>布达拉宫</div>
                            <div class="details-item-value">世界文化遗产，西藏地标</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-temple"></i>大昭寺</div>
                            <div class="details-item-value">藏传佛教圣地，释迦牟尼12岁等身像</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-water"></i>纳木错</div>
                            <div class="details-item-value">西藏三大圣湖之一，世界海拔最高咸水湖</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-water"></i>羊卓雍措</div>
                            <div class="details-item-value">西藏三大圣湖之一，被誉为"天鹅之湖"</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-mountain"></i>米拉山口</div>
                            <div class="details-item-value">海拔5013米，拉萨与林芝的分界山口</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-road"></i>怒江72拐</div>
                            <div class="details-item-value">川藏线上著名险要路段，壮丽景观</div>
                        </div>
                    </div>
                </div>
                <div class="details-section">
                    <h3 class="details-title"><i class="fas fa-info-circle"></i>游览提示</h3>
                    <ul class="details-list">
                        <li>布达拉宫门票需提前7天在官网预约，每日限量参观</li>
                        <li>大昭寺建议请导游讲解，深入了解藏传佛教文化</li>
                        <li>纳木错海拔4718米，注意高反，建议携带氧气瓶</li>
                        <li>羊卓雍措观景台需要购买门票，可拍摄全景照片</li>
                        <li>米拉山口风大温度低，注意保暖和防风</li>
                        <li>怒江72拐观景台位于业拉山垭口，注意安全</li>
                    </ul>
                </div>
            `;
        },

        // 渲染打卡详情
        renderCheckinDetails() {
            const checkinDetails = document.getElementById('checkin-details');

            checkinDetails.innerHTML = `
                <div class="details-section">
                    <h3 class="details-title"><i class="fas fa-camera"></i>最佳拍摄点</h3>
                    <div class="details-grid">
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-sun"></i>纳木错日出</div>
                            <div class="details-item-value">清晨湖面如镜，倒映念青唐古拉山</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-flag"></i>米拉山口经幡</div>
                            <div class="details-item-value">五彩经幡在风中飘扬，象征祝福</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-road"></i>怒江72拐全景</div>
                            <div class="details-item-value">业拉山观景台拍摄蜿蜒公路</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-water"></i>羊卓雍措观景台</div>
                            <div class="details-item-value">拍摄湖面与远山完美结合</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-city"></i>布达拉宫夜景</div>
                            <div class="details-item-value">药王山观景台拍摄灯光下的布宫</div>
                        </div>
                        <div class="details-item">
                            <div class="details-item-label"><i class="fas fa-users"></i>八廓街转经</div>
                            <div class="details-item-value">记录藏民虔诚的转经场景</div>
                        </div>
                    </div>
                </div>
                <div class="details-section">
                    <h3 class="details-title"><i class="fas fa-lightbulb"></i>摄影建议</h3>
                    <ul class="details-list">
                        <li>携带广角镜头拍摄壮阔的自然风光</li>
                        <li>使用偏振镜减少水面和天空的反光</li>
                        <li>高原紫外线强，建议使用UV镜保护镜头</li>
                        <li>早晚光线柔和，是拍摄的最佳时间</li>
                        <li>尊重当地风俗，拍摄人物前请先征得同意</li>
                        <li>备足存储卡和电池，高原地区充电不便</li>
                    </ul>
                </div>
            `;
        },

        // 计算累计里程
        calculateCumulativeMileage(dayNumber) {
            return this.data.days
                .filter(d => d.day <= dayNumber)
                .reduce((sum, day) => sum + day.mileage, 0)
                .toFixed(1);
        },

        // 计算累计费用（简化版）
        calculateCumulativeCost(dayNumber) {
            const days = this.data.days.filter(d => d.day <= dayNumber);
            let totalCost = 0;

            days.forEach(day => {
                const costStr = day.cost;
                if (costStr.includes('-')) {
                    const range = costStr.split('-');
                    const avgCost = (parseFloat(range[0]) + parseFloat(range[1].replace('元', ''))) / 2;
                    totalCost += avgCost;
                } else {
                    totalCost += parseFloat(costStr.replace('元', ''));
                }
            });

            return Math.round(totalCost) + '元';
        },

        // 导出数据
        exportData() {
            const dataStr = JSON.stringify(this.data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'trip-data.json';
            link.click();

            this.showMessage('数据导出成功', 'success');
        },

        // 导入数据
        importData() {
            const fileInput = document.getElementById('importFile');
            if (fileInput.files.length === 0) {
                this.showMessage('请选择要导入的文件', 'error');
                return;
            }

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);

                    if (!importedData.title || !importedData.days) {
                        throw new Error('无效的数据格式');
                    }

                    this.data = importedData;
                    this.calculateStatistics(); // 重新计算统计
                    this.saveData();
                    this.renderAll();
                    this.showMessage('数据导入成功', 'success');
                    this.closeModal();
                } catch (error) {
                    this.showMessage('数据文件格式错误: ' + error.message, 'error');
                }
            };

            reader.onerror = () => {
                this.showMessage('文件读取失败', 'error');
            };

            reader.readAsText(file);
        },

        // 使用模板
        useTemplate(templateName) {
            const templates = {
                tibet: JSON.parse(JSON.stringify(this.defaultData)), // 使用默认数据作为西藏模板
                coastal: {
                    title: "沿海环线机车之旅",
                    totalDays: 10,
                    totalMileage: 2800,
                    totalCost: "3000-3500元",
                    stages: {
                        depart: { name: "去程阶段", days: 5, color: "depart" },
                        stay: { name: "停留阶段", days: 1, color: "stay" },
                        return: { name: "返程阶段", days: 4, color: "return" }
                    },
                    days: [
                        { stage: "depart", day: 1, route: "上海→杭州", mileage: 180, cost: "200-250元", note: "西湖游览" },
                        { stage: "depart", day: 2, route: "杭州→宁波", mileage: 160, cost: "220-260元", note: "沿海公路" },
                        { stage: "depart", day: 3, route: "宁波→温州", mileage: 280, cost: "250-300元", note: "雁荡山景区" },
                        { stage: "depart", day: 4, route: "温州→福州", mileage: 320, cost: "280-330元", note: "闽江风光" },
                        { stage: "depart", day: 5, route: "福州→厦门", mileage: 260, cost: "240-290元", note: "鼓浪屿游览" },
                        { stage: "stay", day: 6, route: "厦门市内休整", mileage: 0, cost: "300-350元", note: "海滨休闲" },
                        { stage: "return", day: 7, route: "厦门→泉州", mileage: 100, cost: "180-230元", note: "古城文化" },
                        { stage: "return", day: 8, route: "泉州→莆田", mileage: 90, cost: "170-220元", note: "湄洲岛" },
                        { stage: "return", day: 9, route: "莆田→福州", mileage: 120, cost: "190-240元", note: "返回福州" },
                        { stage: "return", day: 10, route: "福州→上海", mileage: 720, cost: "400-450元", note: "返回上海" }
                    ],
                    overview: {
                        mileage: { title: "总里程", value: "2800km" },
                        days: { title: "总天数", value: "10天" },
                        cost: { title: "总费用", value: "3000-3500元" },
                        attractions: { title: "核心景点", value: "鼓浪屿" },
                        checkin: { title: "特色打卡", value: "西湖" }
                    }
                }
            };

            if (templates[templateName]) {
                this.data = templates[templateName];
                this.calculateStatistics(); // 重新计算统计
                this.saveData();
                this.renderAll();
                this.showMessage(`已应用${templateName === 'tibet' ? '西藏' : '沿海'}模板`, 'success');
                this.closeModal();
            }
        },

        // 显示消息
        showMessage(message, type = 'info') {
            const messageEl = document.createElement('div');
            messageEl.className = `message ${type}`;
            messageEl.innerHTML = `
                <i class="fas fa-${type == 'success' ? 'check-circle' : type == 'error' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <span>${message}</span>
                <button onclick="this.parentElement.remove()">×</button>
            `;
            document.body.appendChild(messageEl);

            setTimeout(() => {
                if (messageEl.parentElement) {
                    messageEl.remove();
                }
            }, 3000);
        }
    };

    // 搜索功能
    function performSearch(searchTerm) {
        searchTerm = searchTerm.toLowerCase();
        const dayCards = document.querySelectorAll('.day-card');

        // 重置所有高亮
        dayCards.forEach(card => card.classList.remove('highlight'));

        let found = false;
        let firstMatch = null;

        // 搜索所有行程卡片
        dayCards.forEach(card => {
            const routeText = card.querySelector('.day-route').textContent.toLowerCase();
            const noteText = card.querySelector('.day-note span')?.textContent.toLowerCase() || '';

            if (routeText.includes(searchTerm) || noteText.includes(searchTerm)) {
                card.classList.add('highlight');
                found = true;
                if (!firstMatch) firstMatch = card;

                // 确保包含该卡片的阶段是展开的
                const stageItem = card.closest('.stage-item');
                if (stageItem && !stageItem.classList.contains('active')) {
                    stageItem.classList.add('active');
                }
            }
        });

        // 显示搜索结果提示
        const searchNotice = document.getElementById('searchNotice');
        searchNotice.textContent = found ?
            `找到 ${document.querySelectorAll('.day-card.highlight').length} 个匹配结果` :
            `没有找到 "${searchTerm}" 的相关行程`;
        searchNotice.classList.add('show');

        setTimeout(() => {
            searchNotice.classList.remove('show');
        }, 3000);

        if (firstMatch) {
            firstMatch.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        // 初始化数据管理器
        TripDataManager.init();

        // PC端搜索功能
        const searchInput = document.querySelector('.search-input');
        const searchNotice = document.getElementById('searchNotice');
        const searchSuggestions = document.querySelector('.search-suggestions');

        // 搜索建议数据
        const searchTerms = [
            '常德', '洪崖洞', '重庆', '摩域乐迹机车俱乐部', '康定',
            '巴塘县', '八宿县', '波密县', '林芝市', '布达拉宫', '拉萨',
            '那曲市', '丁青县', '昌都市', '德格县', '炉霍县', '汶川县',
            '自贡市', '贵阳市', '怀化市', '石门桥镇', '纳木错'
        ];

        searchInput.addEventListener('input', function() {
            const searchTerm = this.value.trim().toLowerCase();
            if (searchTerm) {
                const filteredTerms = searchTerms.filter(term =>
                    term.toLowerCase().includes(searchTerm)
                );

                if (filteredTerms.length > 0) {
                    searchSuggestions.innerHTML = filteredTerms.map(term =>
                        `<div class="suggestion-item">${term}</div>`
                    ).join('');
                    searchSuggestions.classList.add('active');
                } else {
                    searchSuggestions.classList.remove('active');
                }
            } else {
                searchSuggestions.classList.remove('active');
            }
        });

        // 点击搜索建议
        searchSuggestions.addEventListener('click', function(e) {
            if (e.target.classList.contains('suggestion-item')) {
                searchInput.value = e.target.textContent;
                searchSuggestions.classList.remove('active');
                performSearch(e.target.textContent);
            }
        });

        // 点击其他地方关闭搜索建议
        document.addEventListener('click', function(e) {
            if (!searchInput.contains(e.target) && !searchSuggestions.contains(e.target)) {
                searchSuggestions.classList.remove('active');
            }
        });

        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const searchTerm = this.value.trim();
                if (searchTerm) {
                    performSearch(searchTerm);
                }
            }
        });

        // 分享功能
        document.getElementById('shareWechat').addEventListener('click', function() {
            TripDataManager.showMessage('行程已复制到剪贴板，可以分享给微信好友了！', 'success');
        });

        document.getElementById('mobileShareWechat').addEventListener('click', function() {
            TripDataManager.showMessage('行程已复制到剪贴板，可以分享给微信好友了！', 'success');
        });

        document.getElementById('printTrip').addEventListener('click', function() {
            window.print();
        });

        // 概览卡片点击事件
        const overviewCards = document.querySelectorAll('.overview-card');
        const overviewDetails = document.querySelectorAll('.overview-details');

        overviewCards.forEach(card => {
            card.addEventListener('click', function() {
                const isActive = this.classList.contains('active');

                // 移除所有卡片的active类和详情显示
                overviewCards.forEach(c => c.classList.remove('active'));
                overviewDetails.forEach(detail => detail.classList.remove('active'));

                // 如果不是已经激活状态，则激活当前卡片并显示详情
                if (!isActive) {
                    this.classList.add('active');

                    // 显示对应的详情
                    const cardId = this.id;
                    const detailId = cardId.replace('overview-', '') + '-details';
                    const detailElement = document.getElementById(detailId);

                    if (detailElement) {
                        detailElement.classList.add('active');
                        // 滚动到详情区域
                        detailElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }
                }
            });
        });
    });
</script>
</body>
</html>